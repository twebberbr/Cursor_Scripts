<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplicadores de Lagrange - Explica√ß√£o Geom√©trica Completa</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', Georgia, serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 1.5rem;
            line-height: 1.7;
        }

        .container {
            max-width: 1380px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 0.5rem;
            color: #f8f8f8;
        }

        .subtitle {
            text-align: center;
            font-style: italic;
            color: #a0a0a0;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .section {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            color: #4fc3f7;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(79, 195, 247, 0.3);
        }

        .figure-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .figure-row {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 1.5rem;
            align-items: start;
        }

        .figure-row.reversed {
            grid-template-columns: 1fr 1.2fr;
        }

        .figure-box {
            background: rgba(0,0,0,0.25);
            border-radius: 8px;
            padding: 1rem;
        }

        .figure-box.large {
            padding: 1.5rem;
        }

        .figure-box.xlarge {
            padding: 1rem;
        }

        .figure-box.xlarge svg {
            min-height: 560px;
        }

        .figure-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #81d4fa;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        svg {
            display: block;
            width: 100%;
            height: auto;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
        }

        .explanation {
            font-size: 1rem;
            color: #d0d0d0;
        }

        .explanation p {
            margin-bottom: 0.8rem;
        }

        .math-box {
            background: rgba(79, 195, 247, 0.1);
            border-left: 4px solid #4fc3f7;
            padding: 1rem 1.2rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 1rem;
        }

        .math {
            font-family: 'Crimson Pro', Georgia, serif;
            font-style: italic;
            color: #fff;
        }

        .key-insight {
            background: linear-gradient(135deg, rgba(255,213,79,0.15), rgba(255,183,77,0.1));
            border: 1px solid rgba(255,213,79,0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .key-insight-title {
            color: #ffd54f;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.4rem;
        }

        .step-list {
            counter-reset: step;
            list-style: none;
            padding-left: 0;
        }

        .step-list li {
            counter-increment: step;
            padding: 0.6rem 0 0.6rem 2.5rem;
            position: relative;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.95rem;
        }

        .step-list li::before {
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0.6rem;
            width: 1.8rem;
            height: 1.8rem;
            background: rgba(79, 195, 247, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #4fc3f7;
        }

        .controls {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            margin: 1rem 0;
            flex-wrap: wrap;
            padding: 0.8rem 1rem;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .slider-group label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #81d4fa;
        }

        input[type="range"] {
            width: 160px;
            accent-color: #4fc3f7;
            cursor: pointer;
        }

        .value-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: #ffd54f;
            min-width: 3rem;
            font-weight: 500;
        }

        .status-box {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .status-optimal {
            background: rgba(102, 187, 106, 0.2);
            border: 1px solid #66bb6a;
            color: #a5d6a7;
        }

        .status-suboptimal {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #ff9800;
            color: #ffcc80;
        }

        @media (max-width: 800px) {
            .figure-row, .figure-row.reversed {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>O Significado Geom√©trico do Lagrangeano</h1>
        <p class="subtitle">Por que L(Œª, Œº) = f(Œª) + Œº ¬∑ g(Œª) funciona?</p>
        <div class="key-insight" style="margin-bottom: 1.5rem;">
            <div class="key-insight-title">Nota did√°tica importante</div>
            <p>
                Este material usa um modelo quadr√°tico simplificado com 2 pesos para visualizar a geometria.
                Na krigagem ordin√°ria real, usamos n pesos e resolvemos o sistema
                <span class="math">[C 1; 1·µÄ 0][Œª; Œº] = [c0; 1]</span>; os pesos podem inclusive ser negativos.
            </p>
        </div>

        <!-- SE√á√ÉO 1: O PROBLEMA - INTERATIVO -->
        <div class="section">
            <h2 class="section-title">1. O Problema: Minimizar com Restri√ß√£o</h2>
            <div class="explanation">
                <p>Queremos encontrar pesos <span class="math">Œª = (Œª‚ÇÅ, Œª‚ÇÇ)</span> que <strong>minimizam o erro</strong> <span class="math">f(Œª) = œÉ¬≤</span>, com a restri√ß√£o de n√£o-vi√©s <span class="math">g(Œª) = Œª‚ÇÅ + Œª‚ÇÇ - 1 = 0</span>. Este caso 2D √© s√≥ para visualiza√ß√£o; a ideia √© a mesma da krigagem ordin√°ria com v√°rios pesos.</p>
            </div>

            <div class="math-box">
                <strong>Problema de Otimiza√ß√£o:</strong><br>
                Minimizar <span class="math">f(Œª‚ÇÅ, Œª‚ÇÇ) = œÉ¬≤(Œª)</span><br>
                Sujeito a <span class="math">g(Œª‚ÇÅ, Œª‚ÇÇ) = Œª‚ÇÅ + Œª‚ÇÇ - 1 = 0</span>
            </div>

            <div class="controls">
                <div class="slider-group">
                    <label>Œª‚ÇÅ:</label>
                    <input type="range" id="slider1" min="-20" max="150" value="50">
                    <span class="value-display" id="val1">0.50</span>
                </div>
                <div class="slider-group">
                    <label>Œª‚ÇÇ:</label>
                    <input type="range" id="slider2" min="-20" max="150" value="50">
                    <span class="value-display" id="val2">0.50</span>
                </div>
                <div class="status-box" id="status1">g(Œª) = 0.00 ‚úì Na restri√ß√£o</div>
            </div>

            <div class="figure-row">
                <div class="figure-box large">
                    <div class="figure-label">Figura 1: Espa√ßo dos Pesos</div>
                    <svg id="fig1" viewBox="-40 -20 360 360" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <marker id="arrow1" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#a0a0a0"/>
                            </marker>
                            <radialGradient id="errorGrad" cx="20%" cy="80%" r="80%">
                                <stop offset="0%" style="stop-color:#1a237e;stop-opacity:0.4"/>
                                <stop offset="100%" style="stop-color:#0d47a1;stop-opacity:0"/>
                            </radialGradient>
                        </defs>

                        <rect x="-30" y="-10" width="340" height="340" fill="#0a0a15" rx="6"/>
                        <ellipse cx="50" cy="220" rx="220" ry="132" fill="url(#errorGrad)" transform="rotate(-45 50 220)"/>

                        <!-- Grade -->
                        <g stroke="rgba(255,255,255,0.1)" stroke-width="0.5">
                            <line x1="0" y1="0" x2="0" y2="280"/>
                            <line x1="70" y1="0" x2="70" y2="280"/>
                            <line x1="140" y1="0" x2="140" y2="280"/>
                            <line x1="210" y1="0" x2="210" y2="280"/>
                            <line x1="280" y1="0" x2="280" y2="280"/>
                            <line x1="0" y1="70" x2="280" y2="70"/>
                            <line x1="0" y1="140" x2="280" y2="140"/>
                            <line x1="0" y1="210" x2="280" y2="210"/>
                            <line x1="0" y1="280" x2="280" y2="280"/>
                        </g>

                        <!-- Eixos -->
                        <line x1="-20" y1="280" x2="300" y2="280" stroke="#a0a0a0" stroke-width="1.5" marker-end="url(#arrow1)"/>
                        <line x1="0" y1="300" x2="0" y2="-5" stroke="#a0a0a0" stroke-width="1.5" marker-end="url(#arrow1)"/>
                        <text x="305" y="285" font-family="Crimson Pro" font-size="18" fill="#a0a0a0" font-style="italic">Œª‚ÇÅ</text>
                        <text x="10" y="-10" font-family="Crimson Pro" font-size="18" fill="#a0a0a0" font-style="italic">Œª‚ÇÇ</text>

                        <!-- Marca√ß√µes -->
                        <g font-family="JetBrains Mono" font-size="12" fill="#888">
                            <text x="65" y="298">0.5</text>
                            <text x="135" y="298">1.0</text>
                            <text x="205" y="298">1.5</text>
                            <text x="-25" y="215">0.5</text>
                            <text x="-25" y="145">1.0</text>
                            <text x="-25" y="75">1.5</text>
                        </g>

                        <!-- Curvas de n√≠vel do erro (centro em Œª=(0.3, 0.45) ‚Üí SVG(42, 217)) -->
                        <g fill="none" stroke-width="1.8">
                            <ellipse cx="42" cy="217" rx="20" ry="12" transform="rotate(-45 42 217)" stroke="#1565c0" opacity="0.9"/>
                            <ellipse cx="42" cy="217" rx="40" ry="24" transform="rotate(-45 42 217)" stroke="#1976d2" opacity="0.8"/>
                            <ellipse cx="42" cy="217" rx="65" ry="39" transform="rotate(-45 42 217)" stroke="#1e88e5" opacity="0.7"/>
                            <ellipse cx="42" cy="217" rx="95" ry="57" transform="rotate(-45 42 217)" stroke="#42a5f5" opacity="0.6"/>
                            <ellipse cx="42" cy="217" rx="130" ry="78" transform="rotate(-45 42 217)" stroke="#64b5f6" opacity="0.5"/>
                        </g>

                        <!-- R√≥tulos das elipses -->
                        <g font-family="JetBrains Mono" font-size="11" fill="#64b5f6">
                            <text x="60" y="198">œÉ¬≤=0.1</text>
                            <text x="85" y="173">0.3</text>
                            <text x="115" y="143">0.6</text>
                            <text x="148" y="110">1.0</text>
                        </g>

                        <!-- Centro - m√≠nimo irrestrito (SK) -->
                        <circle cx="42" cy="217" r="9" fill="#2196f3" stroke="#fff" stroke-width="2"/>
                        <text x="10" y="248" font-family="Crimson Pro" font-size="13" fill="#64b5f6">M√≠nimo SK</text>

                        <!-- Restri√ß√£o: Œª‚ÇÅ + Œª‚ÇÇ = 1 (passa por (0,1)‚Üí(0,140) e (1,0)‚Üí(140,280)) -->
                        <line x1="-15" y1="100" x2="180" y2="295" stroke="#ef5350" stroke-width="3"/>
                        <text x="145" y="85" font-family="Crimson Pro" font-size="14" fill="#ef5350" font-weight="600">Œª‚ÇÅ + Œª‚ÇÇ = 1</text>

                        <!-- Ponto m√≥vel do usu√°rio -->
                        <circle id="userPoint1" cx="70" cy="210" r="11" fill="#ff5722" stroke="#fff" stroke-width="2"/>
                        
                        <!-- Linha conectando ao centro -->
                        <line id="distLine1" x1="42" y1="217" x2="70" y2="210" stroke="#ffab91" stroke-width="1.5" stroke-dasharray="4,3"/>

                        <!-- Info box -->
                        <g id="infoBox1">
                            <rect x="180" y="15" width="100" height="70" rx="4" fill="rgba(0,0,0,0.7)" stroke="rgba(255,255,255,0.2)"/>
                            <text x="190" y="35" font-family="JetBrains Mono" font-size="11" fill="#81d4fa">Posi√ß√£o:</text>
                            <text id="posInfo1" x="190" y="52" font-family="JetBrains Mono" font-size="11" fill="#fff">Œª = (0.50, 0.50)</text>
                            <text x="190" y="68" font-family="JetBrains Mono" font-size="11" fill="#fff59d">Erro:</text>
                            <text id="errInfo1" x="240" y="68" font-family="JetBrains Mono" font-size="11" fill="#fff">0.20</text>
                        </g>
                    </svg>
                </div>

                <div class="explanation">
                    <p><strong>Use os sliders</strong> para explorar o espa√ßo dos pesos:</p>
                    <ul class="step-list">
                        <li>As <strong style="color:#64b5f6">curvas azuis</strong> s√£o as curvas de n√≠vel do erro œÉ¬≤. Quanto mais perto do centro, menor o erro.</li>
                        <li>O <strong style="color:#2196f3">ponto azul</strong> √© o m√≠nimo irrestrito (Simple Kriging).</li>
                        <li>A <strong style="color:#ef5350">reta vermelha</strong> √© a restri√ß√£o: Œª‚ÇÅ + Œª‚ÇÇ = 1.</li>
                        <li>O <strong style="color:#ff5722">ponto laranja</strong> √© sua posi√ß√£o atual.</li>
                        <li>Na pr√°tica, pesos de krigagem podem ser <strong>negativos</strong> dependendo da geometria e do modelo.</li>
                    </ul>

                    <div class="key-insight">
                        <div class="key-insight-title">üí° Experimente!</div>
                        <p>Mova Œª‚ÇÅ e Œª‚ÇÇ para ver como o erro muda. S√≥ podemos escolher pontos <strong>sobre a reta vermelha</strong>!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 2: CONDI√á√ÉO DE TANG√äNCIA - INTERATIVO -->
        <div class="section">
            <h2 class="section-title">2. A Condi√ß√£o de Tang√™ncia: Gradientes Paralelos</h2>
            
            <div class="explanation">
                <p>No ponto √≥timo sobre a restri√ß√£o, <strong>n√£o h√° dire√ß√£o de melhoria</strong> ao longo da reta. Isso significa que o gradiente do erro (‚àáf) deve ser <strong>perpendicular √† restri√ß√£o</strong> ‚Äî ou seja, paralelo ao gradiente da restri√ß√£o (‚àág).</p>
            </div>

            <div class="controls">
                <div class="slider-group">
                    <label>Posi√ß√£o na restri√ß√£o (Œª‚ÇÅ):</label>
                    <input type="range" id="slider2a" min="5" max="95" value="50">
                    <span class="value-display" id="val2a">0.50</span>
                </div>
                <div class="status-box" id="status2">œÉ¬≤ = 0.20 | comp. tangencial = 0.00</div>
            </div>

            <div class="figure-row">
                <div class="figure-box large">
                    <div class="figure-label">Figura 2: Gradientes e Componente Tangencial</div>
                    <svg id="fig2" viewBox="-30 -15 330 330" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <marker id="arrowOrange2" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                                <polygon points="0 0, 6 2.5, 0 5" fill="#ff9800"/>
                            </marker>
                            <marker id="arrowPurple2" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                                <polygon points="0 0, 6 2.5, 0 5" fill="#ab47bc"/>
                            </marker>
                            <marker id="arrowGreen2" markerWidth="5" markerHeight="4" refX="4" refY="2" orient="auto">
                                <polygon points="0 0, 5 2, 0 4" fill="#66bb6a"/>
                            </marker>
                        </defs>

                        <rect x="-20" y="-5" width="310" height="310" fill="#0a0a15" rx="6"/>

                        <!-- Elipses de n√≠vel (centro em SK: Œª=(0.3, 0.45) ‚Üí SVG(42, 217)) -->
                        <g fill="none" stroke-width="1.5">
                            <ellipse cx="42" cy="217" rx="20" ry="12" transform="rotate(-45 42 217)" stroke="#1565c0" opacity="0.6"/>
                            <ellipse cx="42" cy="217" rx="40" ry="24" transform="rotate(-45 42 217)" stroke="#1976d2" opacity="0.5"/>
                            <ellipse cx="42" cy="217" rx="65" ry="39" transform="rotate(-45 42 217)" stroke="#1e88e5" opacity="0.4"/>
                            <ellipse cx="42" cy="217" rx="95" ry="57" transform="rotate(-45 42 217)" stroke="#42a5f5" opacity="0.3"/>
                        </g>

                        <!-- Centro - m√≠nimo SK -->
                        <circle cx="42" cy="217" r="7" fill="#2196f3" stroke="#fff" stroke-width="1.5"/>

                        <!-- Restri√ß√£o Œª‚ÇÅ + Œª‚ÇÇ = 1 
                             Œª‚ÇÅ=0, Œª‚ÇÇ=1 ‚Üí SVG(0, 280-140) = (0, 140)
                             Œª‚ÇÅ=1, Œª‚ÇÇ=0 ‚Üí SVG(140, 280-0) = (140, 280)
                             Estendendo um pouco: (-10, 130) a (155, 295) -->
                        <line id="constraintLine2" x1="-10" y1="130" x2="155" y2="295" stroke="#ef5350" stroke-width="2.5"/>

                        <!-- Ponto m√≥vel SOBRE a restri√ß√£o -->
                        <circle id="point2" cx="70" cy="210" r="10" fill="#ff5722" stroke="#fff" stroke-width="2"/>

                        <!-- Gradiente ‚àáf (laranja) -->
                        <line id="gradF2" x1="70" y1="210" x2="130" y2="150" stroke="#ff9800" stroke-width="2.5" marker-end="url(#arrowOrange2)"/>
                        <text id="labelF2" x="135" y="145" font-family="Crimson Pro" font-size="16" fill="#ff9800" font-weight="600">‚àáf</text>

                        <!-- Gradiente ‚àág (roxo) -->
                        <line id="gradG2" x1="70" y1="210" x2="115" y2="165" stroke="#ab47bc" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowPurple2)"/>
                        <text id="labelG2" x="120" y="162" font-family="Crimson Pro" font-size="16" fill="#ab47bc" font-weight="600">‚àág</text>

                        <!-- Componente tangencial (verde) -->
                        <line id="tangComp2" x1="70" y1="210" x2="100" y2="240" stroke="#66bb6a" stroke-width="2" marker-end="url(#arrowGreen2)"/>
                        <text id="tangLabel2" x="105" y="255" font-family="Crimson Pro" font-size="12" fill="#a5d6a7">comp. tang.</text>

                        <!-- Caixa de status -->
                        <rect id="statusBox2" x="160" y="15" width="115" height="60" rx="6" fill="rgba(255,152,0,0.15)" stroke="#ff9800" stroke-width="1.5"/>
                        <text id="statusText2a" x="175" y="38" font-family="Crimson Pro" font-size="15" fill="#ffcc80">N√£o √© √≥timo!</text>
                        <text id="statusText2b" x="175" y="58" font-family="JetBrains Mono" font-size="11" fill="#ffcc80">comp.tang ‚â† 0</text>

                        <!-- Legenda -->
                        <g font-family="Crimson Pro" font-size="11">
                            <rect x="160" y="85" width="115" height="75" rx="4" fill="rgba(0,0,0,0.5)" stroke="rgba(255,255,255,0.2)"/>
                            <line x1="170" y1="102" x2="200" y2="102" stroke="#ff9800" stroke-width="2"/>
                            <text x="205" y="106" fill="#ffb74d">‚àáf (grad. erro)</text>
                            <line x1="170" y1="122" x2="200" y2="122" stroke="#ab47bc" stroke-width="2" stroke-dasharray="4,2"/>
                            <text x="205" y="126" fill="#ce93d8">‚àág (normal)</text>
                            <line x1="170" y1="142" x2="200" y2="142" stroke="#66bb6a" stroke-width="2"/>
                            <text x="205" y="146" fill="#a5d6a7">comp. tang.</text>
                        </g>
                    </svg>
                </div>

                <div class="explanation">
                    <ul class="step-list">
                        <li>O <strong style="color:#ff9800">‚àáf (laranja)</strong> aponta na dire√ß√£o onde o erro AUMENTA mais r√°pido.</li>
                        <li>O <strong style="color:#ab47bc">‚àág (roxo)</strong> √© perpendicular √† restri√ß√£o.</li>
                        <li>A <strong style="color:#66bb6a">comp. tang. (verde)</strong> mostra se h√° dire√ß√£o de melhoria na reta.</li>
                        <li>No <strong>√≥timo</strong>: comp. tang. = 0, gradientes paralelos!</li>
                    </ul>

                    <div class="math-box">
                        <strong>Condi√ß√£o de Otimalidade:</strong><br>
                        <span class="math">‚àáf = ‚àíŒº ¬∑ ‚àág</span> (paralelos!)
                    </div>

                    <div class="key-insight">
                        <div class="key-insight-title">üí° Encontre o √ìtimo!</div>
                        <p>Mova o slider at√© a <strong style="color:#66bb6a">componente tangencial ser zero</strong>. Neste ponto, ‚àáf e ‚àág s√£o paralelos!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 3: O LAGRANGEANO -->
        <div class="section">
            <h2 class="section-title">3. O Lagrangeano: A Fun√ß√£o M√°gica</h2>

            <div class="explanation">
                <p>O <strong>Lagrangeano</strong> combina objetivo e restri√ß√£o em uma √∫nica fun√ß√£o. Encontrar seus pontos estacion√°rios (‚àáL = 0) nos d√° automaticamente: (1) gradientes paralelos e (2) estar na restri√ß√£o.</p>
            </div>

            <div class="math-box" style="text-align: center; font-size: 1.15rem;">
                <span class="math" style="font-size: 1.3rem;">L(Œª, Œº) = f(Œª) + Œº ¬∑ g(Œª)</span><br><br>
                <span style="font-size: 0.95rem;">L(Œª‚ÇÅ, Œª‚ÇÇ, Œº) = œÉ¬≤(Œª‚ÇÅ, Œª‚ÇÇ) + Œº ¬∑ (Œª‚ÇÅ + Œª‚ÇÇ ‚àí 1)</span>
            </div>

            <div class="controls">
                <div class="slider-group">
                    <label>Multiplicador Œº:</label>
                    <input type="range" id="slider3" min="-100" max="100" value="0">
                    <span class="value-display" id="val3">0.00</span>
                </div>
            </div>

            <div class="figure-row reversed">
                <div class="explanation">
                    <p><strong>Por que funciona?</strong> As condi√ß√µes ‚àáL = 0 d√£o:</p>
                    
                    <div class="math-box">
                        <span class="math">‚àÇL/‚àÇŒª‚ÇÅ = 0</span> ‚Üí <span class="math">‚àÇf/‚àÇŒª‚ÇÅ + Œº = 0</span><br>
                        <span class="math">‚àÇL/‚àÇŒª‚ÇÇ = 0</span> ‚Üí <span class="math">‚àÇf/‚àÇŒª‚ÇÇ + Œº = 0</span><br>
                        <span class="math">‚àÇL/‚àÇŒº = 0</span> ‚Üí <span class="math">g(Œª) = 0</span> ‚Üê <strong style="color:#ffd54f">a restri√ß√£o!</strong>
                    </div>

                    <p>As duas primeiras: <span class="math">‚àáf = ‚àíŒº‚àág</span> (paralelos).</p>
                    <p>A terceira: estamos <strong>sobre a restri√ß√£o</strong>.</p>

                    <div class="key-insight">
                        <div class="key-insight-title">üí° O truque genial</div>
                        <p>O Lagrangeano transforma otimiza√ß√£o com restri√ß√£o em encontrar pontos estacion√°rios ‚Äî muito mais f√°cil!</p>
                    </div>
                </div>

                <div class="figure-box large">
                    <div class="figure-label">Figura 3: Construindo o Lagrangeano</div>
                    <svg id="fig3" viewBox="0 0 320 380" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="320" height="380" fill="#0a0a15" rx="6"/>

                        <!-- Caixa f(Œª) - Objetivo -->
                        <rect x="20" y="30" width="120" height="70" rx="10" fill="rgba(33,150,243,0.2)" stroke="#42a5f5" stroke-width="2.5"/>
                        <text x="45" y="58" font-family="Crimson Pro" font-size="15" fill="#90caf9">Objetivo</text>
                        <text x="40" y="85" font-family="Crimson Pro" font-size="22" fill="#42a5f5" font-style="italic">f(Œª) = œÉ¬≤</text>

                        <!-- Sinal de + -->
                        <text x="150" y="75" font-family="Crimson Pro" font-size="32" fill="#fff">+</text>

                        <!-- Caixa Œº¬∑g(Œª) - Penalidade -->
                        <rect x="180" y="30" width="120" height="70" rx="10" fill="rgba(239,83,80,0.2)" stroke="#ef5350" stroke-width="2.5"/>
                        <text x="200" y="58" font-family="Crimson Pro" font-size="15" fill="#ef9a9a">Penalidade</text>
                        <text x="195" y="85" font-family="Crimson Pro" font-size="22" fill="#ef5350" font-style="italic">Œº ¬∑ g(Œª)</text>

                        <!-- C√≠rculo Œº entre as caixas -->
                        <circle cx="160" cy="35" r="22" fill="rgba(255,213,79,0.25)" stroke="#ffd54f" stroke-width="2.5"/>
                        <text id="muDisplay3" x="150" y="43" font-family="Crimson Pro" font-size="22" fill="#ffd54f" font-style="italic">Œº</text>

                        <!-- Seta para baixo -->
                        <line x1="160" y1="115" x2="160" y2="155" stroke="#888" stroke-width="2.5"/>
                        <polygon points="160,165 148,150 172,150" fill="#888"/>

                        <!-- Caixa do Lagrangeano -->
                        <rect x="30" y="180" width="260" height="80" rx="12" fill="rgba(102,187,106,0.18)" stroke="#66bb6a" stroke-width="3"/>
                        <text x="105" y="212" font-family="Crimson Pro" font-size="18" fill="#a5d6a7">Lagrangeano</text>
                        <text id="lagrangeFormula" x="55" y="245" font-family="Crimson Pro" font-size="20" fill="#66bb6a" font-style="italic">L = œÉ¬≤ + 0.0 ¬∑ g</text>

                        <!-- Caixa de explica√ß√£o -->
                        <rect x="20" y="280" width="280" height="90" rx="8" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.15)"/>
                        
                        <text x="35" y="305" font-family="Crimson Pro" font-size="14" fill="#e0e0e0" font-weight="600">O que Œº faz:</text>
                        
                        <text id="muExplain1" x="35" y="328" font-family="Crimson Pro" font-size="13" fill="#888">‚Ä¢ Œº = 0: L = f (ignora restri√ß√£o)</text>
                        <text id="muExplain2" x="35" y="348" font-family="Crimson Pro" font-size="13" fill="#888">‚Ä¢ Œº > 0: penaliza g > 0</text>
                        <text id="muExplain3" x="35" y="368" font-family="Crimson Pro" font-size="13" fill="#888">‚Ä¢ Œº &lt; 0: penaliza g &lt; 0</text>
                    </svg>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 4: SIGNIFICADO DE Œº - FIGURA COMBINADA -->
        <div class="section">
            <h2 class="section-title">4. O Significado de Œº: Conectando as Duas Vis√µes</h2>

            <div class="explanation">
                <p>O multiplicador Œº aparece em <strong>duas interpreta√ß√µes equivalentes</strong>. Vamos ver como elas se conectam:</p>
            </div>

            <div class="controls">
                <div class="slider-group">
                    <label>Valor da restri√ß√£o c = Œª‚ÇÅ + Œª‚ÇÇ:</label>
                    <input type="range" id="slider4" min="50" max="130" value="100">
                    <span class="value-display" id="val4">1.00</span>
                </div>
                <div class="status-box" id="status4">c = 1.00 | carregando...</div>
            </div>

            <!-- Figura combinada: duas vistas lado a lado -->
            <div class="figure-box large" style="padding: 1.5rem;">
                <div class="figure-label">Figura 4: Duas Vis√µes do Mesmo Problema</div>
                <svg id="fig4combined" viewBox="0 0 750 340" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrowAxis4" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#a0a0a0"/>
                        </marker>
                        <marker id="arrowOrange4" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                            <polygon points="0 0, 6 2.5, 0 5" fill="#ff9800"/>
                        </marker>
                        <marker id="arrowPurple4" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                            <polygon points="0 0, 6 2.5, 0 5" fill="#ab47bc"/>
                        </marker>
                        <marker id="arrowGreen4" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                            <polygon points="0 0, 6 2.5, 0 5" fill="#66bb6a"/>
                        </marker>
                        <marker id="arrowMagenta4" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                            <polygon points="0 0, 6 2.5, 0 5" fill="#ff4dd2"/>
                        </marker>
                        <marker id="arrowCyan4" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                            <polygon points="0 0, 6 2.5, 0 5" fill="#4dd0e1"/>
                        </marker>
                    </defs>

                    <!-- ========== PAINEL ESQUERDO: Vista de Cima (espa√ßo Œª‚ÇÅ, Œª‚ÇÇ) ========== -->
                    <rect x="10" y="10" width="320" height="320" fill="#0a0a15" rx="6"/>
                    
                    <!-- T√≠tulo -->
                    <text x="90" y="35" font-family="Crimson Pro" font-size="14" fill="#81d4fa" font-weight="600">Vista de Cima: Espa√ßo (Œª‚ÇÅ, Œª‚ÇÇ)</text>

                    <!-- Eixos -->
                    <line x1="50" y1="290" x2="310" y2="290" stroke="#a0a0a0" stroke-width="1" marker-end="url(#arrowAxis4)"/>
                    <line x1="50" y1="290" x2="50" y2="50" stroke="#a0a0a0" stroke-width="1" marker-end="url(#arrowAxis4)"/>
                    <text x="300" y="308" font-family="Crimson Pro" font-size="13" fill="#a0a0a0" font-style="italic">Œª‚ÇÅ</text>
                    <text x="35" y="55" font-family="Crimson Pro" font-size="13" fill="#a0a0a0" font-style="italic">Œª‚ÇÇ</text>

                    <!-- Curvas de n√≠vel do erro (centro em SK) -->
                    <g fill="none" stroke-width="1.2" transform="translate(50, 290)">
                        <ellipse cx="54" cy="-81" rx="18" ry="11" transform="rotate(-45 54 -81)" stroke="#1565c0" opacity="0.5"/>
                        <ellipse cx="54" cy="-81" rx="36" ry="22" transform="rotate(-45 54 -81)" stroke="#1976d2" opacity="0.4"/>
                        <ellipse cx="54" cy="-81" rx="58" ry="35" transform="rotate(-45 54 -81)" stroke="#1e88e5" opacity="0.35"/>
                        <ellipse cx="54" cy="-81" rx="85" ry="51" transform="rotate(-45 54 -81)" stroke="#42a5f5" opacity="0.3"/>
                    </g>

                    <!-- Centro SK -->
                    <circle cx="104" cy="209" r="6" fill="#2196f3" stroke="#fff" stroke-width="1.5"/>
                    <text x="75" y="235" font-family="JetBrains Mono" font-size="9" fill="#64b5f6">SK</text>

                    <!-- Fam√≠lia de restri√ß√µes (linhas paralelas c = constante) -->
                    <!-- c = 0.5: Œª‚ÇÅ+Œª‚ÇÇ=0.5 ‚Üí (0,0.5) a (0.5,0) ‚Üí SVG: (50,200) a (140,290) -->
                    <line x1="50" y1="200" x2="140" y2="290" stroke="rgba(239,83,80,0.2)" stroke-width="1"/>
                    <text x="55" y="195" font-family="JetBrains Mono" font-size="9" fill="rgba(239,83,80,0.4)">c=0.5</text>
                    
                    <!-- c = 0.75: (0,0.75) a (0.75,0) ‚Üí SVG: (50,155) a (185,290) -->
                    <line x1="50" y1="155" x2="185" y2="290" stroke="rgba(239,83,80,0.3)" stroke-width="1.5"/>
                    <text x="55" y="150" font-family="JetBrains Mono" font-size="9" fill="rgba(239,83,80,0.5)">c=0.75</text>
                    
                    <!-- c = 1.0: (0,1) a (1,0) ‚Üí SVG: (50,110) a (230,290) - PRINCIPAL -->
                    <line id="constraint100" x1="50" y1="110" x2="230" y2="290" stroke="#ef5350" stroke-width="2.5"/>
                    <text x="55" y="105" font-family="JetBrains Mono" font-size="10" fill="#ef5350">c=1.0</text>
                    
                    <!-- c = 1.25: (0,1.25) a (1.25,0) ‚Üí SVG: (50,65) a (275,290) -->
                    <line x1="50" y1="65" x2="275" y2="290" stroke="rgba(239,83,80,0.3)" stroke-width="1.5"/>
                    <text x="55" y="60" font-family="JetBrains Mono" font-size="9" fill="rgba(239,83,80,0.5)">c=1.25</text>

                    <!-- Ponto √≥timo na restri√ß√£o atual -->
                    <circle id="point4left" cx="140" cy="200" r="9" fill="#ff5722" stroke="#fff" stroke-width="2"/>

                    <!-- Gradiente ‚àáf (laranja) -->
                    <line id="gradF4" x1="140" y1="200" x2="190" y2="150" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowOrange4)"/>
                    <text id="labelF4" x="195" y="148" font-family="Crimson Pro" font-size="13" fill="#ff9800" font-weight="600">‚àáf</text>

                    <!-- Gradiente ‚àág (roxo) - sempre perpendicular √†s restri√ß√µes -->
                    <line id="gradG4" x1="140" y1="200" x2="175" y2="165" stroke="#ab47bc" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrowPurple4)"/>
                    <text id="labelG4" x="178" y="162" font-family="Crimson Pro" font-size="13" fill="#ab47bc" font-weight="600">‚àág</text>

                    <!-- Legenda esquerda -->
                    <g font-family="Crimson Pro" font-size="10">
                        <rect x="200" y="45" width="120" height="55" rx="4" fill="rgba(0,0,0,0.5)" stroke="rgba(255,255,255,0.2)"/>
                        <text x="210" y="62" fill="#ffb74d">‚àáf aponta para ‚Üë erro</text>
                        <text x="210" y="78" fill="#ce93d8">‚àág ‚ä• √†s restri√ß√µes</text>
                        <text x="210" y="94" fill="#ef9a9a">Linhas = c constante</text>
                    </g>

                    <!-- ========== SETA DE CONEX√ÉO ========== -->
                    <line x1="340" y1="170" x2="380" y2="170" stroke="#ffd54f" stroke-width="2"/>
                    <polygon points="390,170 375,162 375,178" fill="#ffd54f"/>
                    <text x="345" y="155" font-family="Crimson Pro" font-size="11" fill="#ffd54f">projetar</text>
                    <text x="350" y="190" font-family="Crimson Pro" font-size="11" fill="#ffd54f">em c</text>

                    <!-- ========== PAINEL DIREITO: Curva œÉ¬≤*(c) ========== -->
                    <rect x="410" y="10" width="330" height="320" fill="#0a0a15" rx="6"/>
                    
                    <!-- T√≠tulo -->
                    <text x="470" y="35" font-family="Crimson Pro" font-size="14" fill="#81d4fa" font-weight="600">Vista Lateral: Curva œÉ¬≤*(c)</text>

                    <!-- Eixos -->
                    <line x1="450" y1="280" x2="710" y2="280" stroke="#a0a0a0" stroke-width="1" marker-end="url(#arrowAxis4)"/>
                    <line x1="450" y1="290" x2="450" y2="50" stroke="#a0a0a0" stroke-width="1" marker-end="url(#arrowAxis4)"/>
                    <text x="680" y="300" font-family="Crimson Pro" font-size="13" fill="#a0a0a0">c</text>
                    <text x="425" y="55" font-family="Crimson Pro" font-size="13" fill="#a0a0a0" font-style="italic">œÉ¬≤*</text>

                    <!-- Marca√ß√µes eixo X -->
                    <g font-family="JetBrains Mono" font-size="10" fill="#888">
                        <text x="478" y="296">0.5</text>
                        <text x="528" y="296">0.75</text>
                        <text x="578" y="296">1.0</text>
                        <text x="628" y="296">1.25</text>
                    </g>

                    <!-- Curva œÉ¬≤*(c) -->
                    <path id="curve4" fill="none" stroke="#42a5f5" stroke-width="3" stroke-linecap="round"/>

                    <!-- Linhas verticais tracejadas conectando as restri√ß√µes -->
                    <line x1="490" y1="280" x2="490" y2="60" stroke="rgba(239,83,80,0.15)" stroke-width="1" stroke-dasharray="3,3"/>
                    <line x1="540" y1="280" x2="540" y2="60" stroke="rgba(239,83,80,0.2)" stroke-width="1" stroke-dasharray="3,3"/>
                    <line x1="590" y1="280" x2="590" y2="60" stroke="rgba(239,83,80,0.4)" stroke-width="1" stroke-dasharray="3,3"/>
                    <line x1="640" y1="280" x2="640" y2="60" stroke="rgba(239,83,80,0.2)" stroke-width="1" stroke-dasharray="3,3"/>

                    <!-- M√≠nimo SK -->
                    <circle id="minSK4" cx="540" cy="280" r="7" fill="#2196f3" stroke="#fff" stroke-width="1.5"/>
                    <text x="520" y="310" font-family="JetBrains Mono" font-size="9" fill="#64b5f6">SK (c‚âà0.75)</text>

                    <!-- Tangente da curva sigma2*(c) -->
                    <line id="tangent4" x1="500" y1="250" x2="680" y2="180" stroke="rgba(102,187,106,0.45)" stroke-width="1.6" stroke-dasharray="6,5"/>

                    <!-- Ponto na curva (correspondente ao ponto esquerdo) -->
                    <circle id="point4right" cx="590" cy="220" r="9" fill="#ff5722" stroke="#fff" stroke-width="2"/>

                    <!-- Vetores locais no corte (todos saem do ponto laranja) -->
                    <line id="tanVec4" x1="590" y1="220" x2="628" y2="195" stroke="#66bb6a" stroke-width="3" marker-end="url(#arrowGreen4)"/>
                    <line id="compCVec4" x1="590" y1="220" x2="628" y2="220" stroke="#ff9800" stroke-width="2.4" marker-end="url(#arrowOrange4)"/>
                    <line id="compSigVec4" x1="628" y1="220" x2="628" y2="195" stroke="#ff4dd2" stroke-width="2.4" marker-end="url(#arrowMagenta4)"/>
                    <line id="normalVec4" x1="590" y1="220" x2="572" y2="190" stroke="#4dd0e1" stroke-width="2.2" stroke-dasharray="4,3" marker-end="url(#arrowCyan4)"/>
                    <text id="labelTanVec4" x="634" y="192" font-family="Crimson Pro" font-size="11" fill="#a5d6a7">t (tangente)</text>
                    <text id="labelCompCVec4" x="596" y="236" font-family="JetBrains Mono" font-size="10" fill="#ffb74d">Œîc (horizontal)</text>
                    <text id="labelCompSigVec4" x="632" y="208" font-family="JetBrains Mono" font-size="10" fill="#ff77dd">ŒîœÉ¬≤ (vertical)</text>
                    <text id="labelNormalVec4" x="548" y="186" font-family="JetBrains Mono" font-size="10" fill="#80deea">n (normal 2D)</text>

                    <!-- Linha vertical do ponto ao eixo -->
                    <line id="vline4" x1="590" y1="280" x2="590" y2="220" stroke="#ff5722" stroke-width="1.5" stroke-dasharray="5,3"/>

                    <!-- Caixa Œº -->
                    <rect x="656" y="70" width="76" height="70" rx="6" fill="rgba(255,213,79,0.15)" stroke="#ffd54f" stroke-width="1.5"/>
                    <text x="659" y="95" font-family="Crimson Pro" font-size="13" fill="#fff59d" font-style="italic">Œº = -dœÉ¬≤*/dc</text>
                    <text id="muResult4" x="675" y="125" font-family="JetBrains Mono" font-size="16" fill="#fff" font-weight="bold">‚âà 0.40</text>

                    <!-- Legenda vetorial -->
                    <g font-family="Crimson Pro" font-size="10">
                        <rect x="638" y="150" width="96" height="108" rx="4" fill="rgba(0,0,0,0.48)" stroke="rgba(255,255,255,0.22)"/>
                        <text x="644" y="168" fill="#a5d6a7">verde: t tangente</text>
                        <text x="644" y="184" fill="#ffb74d">laranja: Œîc horiz.</text>
                        <text x="644" y="200" fill="#ff77dd">magenta: ŒîœÉ¬≤ vert.</text>
                        <text x="644" y="216" fill="#80deea">ciano: normal 2D</text>
                        <text x="644" y="232" fill="#fff59d">Œº = -ŒîœÉ¬≤/Œîc</text>
                        <text x="644" y="248" fill="#b0bec5">ŒîœÉ¬≤ vert. ‚â† normal 3D</text>
                    </g>
                </svg>
            </div>

            <div class="explanation" style="margin-top: 1rem;">
                <div class="math-box">
                    <strong>A conex√£o entre as duas vistas:</strong><br><br>
                    <strong>Esquerda:</strong> No espa√ßo (Œª‚ÇÅ, Œª‚ÇÇ), cada linha vermelha √© uma restri√ß√£o c = constante.<br>
                    O ponto laranja est√° no <strong>m√≠nimo de œÉ¬≤ sobre a linha c atual</strong>.<br><br>
                    <strong>Direita:</strong> A curva azul mostra esse m√≠nimo œÉ¬≤*(c) para cada valor de c.<br>
                    A <strong>inclina√ß√£o da tangente</strong> √© <span class="math">dœÉ¬≤*/dc</span>, e com a conven√ß√£o
                    <span class="math">L = f + Œº(Œª‚ÇÅ + Œª‚ÇÇ - c)</span> vale <span class="math">Œº = -dœÉ¬≤*/dc</span>.
                    No corte: vetor <span style="color:#a5d6a7;">verde</span> (tangente) = componente
                    <span style="color:#ffb74d;">laranja</span> em c + componente
                    <span style="color:#ff77dd;">magenta</span> em œÉ¬≤. O vetor
                    <span style="color:#80deea;">ciano</span> √© a normal da <strong>curva 2D</strong> no corte
                    (nao e a normal da superficie 3D do erro).
                </div>

                <div class="key-insight">
                    <div class="key-insight-title">üí° Œº tem dois significados equivalentes:</div>
                    <p><strong>1.</strong> No espa√ßo (Œª‚ÇÅ, Œª‚ÇÇ): Œº relaciona ‚àáf e ‚àág pela equa√ß√£o <span class="math">‚àáf = ‚àíŒº‚àág</span></p>
                    <p><strong>2.</strong> Na curva œÉ¬≤*(c): Œº √© o <strong>negativo da inclina√ß√£o</strong>, pela conven√ß√£o adotada para o Lagrangeano.</p>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 5: FIGURA S√çNTESE (FIG. 2 + FIG. 4) -->
        <div class="section">
            <h2 class="section-title">5. Figura S√≠ntese: Tang√™ncia Local + Curva de M√≠nimos</h2>

            <div class="explanation">
                <p>
                    Esta figura junta o que havia separado nas Figuras 2 e 4:
                    <strong>√† esquerda</strong>, a geometria no espa√ßo dos pesos (gradientes e componente tangencial);
                    <strong>√† direita</strong>, a vista em corte <span class="math">œÉ¬≤*(c)</span> e a leitura de
                    <span class="math">Œº = -dœÉ¬≤*/dc</span>.
                </p>
            </div>

            <div class="controls">
                <div class="slider-group">
                    <label>Restri√ß√£o ativa c = Œª‚ÇÅ + Œª‚ÇÇ:</label>
                    <input type="range" id="slider5c" min="50" max="130" value="100">
                    <span class="value-display" id="val5c">1.00</span>
                </div>
                <div class="slider-group">
                    <label>Deslocamento na restri√ß√£o (u):</label>
                    <input type="range" id="slider5u" min="-25" max="25" value="0">
                    <span class="value-display" id="val5u">0.00</span>
                </div>
                <div class="status-box" id="status5">u = 0.00 | ponto atual no m√≠nimo da restri√ß√£o</div>
            </div>

            <div class="figure-box xlarge">
                <div class="figure-label">Figura 5: S√≠ntese Geom√©trica (Painel Œª + Painel de Corte)</div>
                <svg id="fig5" viewBox="0 0 1280 620" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrowAxis5" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#a0a0a0"/>
                        </marker>
                        <marker id="arrowOrange5" markerWidth="7" markerHeight="6" refX="6" refY="3" orient="auto">
                            <polygon points="0 0, 7 3, 0 6" fill="#ff9800"/>
                        </marker>
                        <marker id="arrowPurple5" markerWidth="7" markerHeight="6" refX="6" refY="3" orient="auto">
                            <polygon points="0 0, 7 3, 0 6" fill="#ab47bc"/>
                        </marker>
                        <marker id="arrowGreen5" markerWidth="7" markerHeight="6" refX="6" refY="3" orient="auto">
                            <polygon points="0 0, 7 3, 0 6" fill="#66bb6a"/>
                        </marker>
                    </defs>

                    <!-- Painel esquerdo -->
                    <rect x="20" y="40" width="590" height="540" rx="8" fill="#070b1d" stroke="rgba(255,255,255,0.14)"/>
                    <text x="190" y="74" font-family="Crimson Pro" font-size="28" fill="#81d4fa" font-weight="600">Espa√ßo dos pesos (Œª‚ÇÅ, Œª‚ÇÇ)</text>

                    <!-- Eixos -->
                    <line x1="90" y1="520" x2="560" y2="520" stroke="#a0a0a0" stroke-width="1.6" marker-end="url(#arrowAxis5)"/>
                    <line x1="90" y1="520" x2="90" y2="80" stroke="#a0a0a0" stroke-width="1.6" marker-end="url(#arrowAxis5)"/>
                    <text x="540" y="548" font-family="Crimson Pro" font-size="24" fill="#a0a0a0" font-style="italic">Œª‚ÇÅ</text>
                    <text x="62" y="95" font-family="Crimson Pro" font-size="24" fill="#a0a0a0" font-style="italic">Œª‚ÇÇ</text>

                    <!-- Fam√≠lia de restri√ß√µes de refer√™ncia -->
                    <line x1="90" y1="355" x2="255" y2="520" stroke="rgba(239,83,80,0.24)" stroke-width="1.2"/>
                    <line x1="90" y1="272.5" x2="337.5" y2="520" stroke="rgba(239,83,80,0.28)" stroke-width="1.4"/>
                    <line x1="90" y1="190" x2="420" y2="520" stroke="rgba(239,83,80,0.34)" stroke-width="1.6"/>
                    <line x1="90" y1="107.5" x2="502.5" y2="520" stroke="rgba(239,83,80,0.28)" stroke-width="1.4"/>
                    <text x="98" y="350" font-family="JetBrains Mono" font-size="13" fill="rgba(239,83,80,0.52)">c=0.5</text>
                    <text x="98" y="268" font-family="JetBrains Mono" font-size="13" fill="rgba(239,83,80,0.62)">c=0.75</text>
                    <text x="98" y="185" font-family="JetBrains Mono" font-size="13" fill="rgba(239,83,80,0.75)">c=1.0</text>
                    <text x="98" y="102" font-family="JetBrains Mono" font-size="13" fill="rgba(239,83,80,0.62)">c=1.25</text>

                    <!-- Contornos do erro -->
                    <g fill="none" stroke-width="2">
                        <ellipse cx="189" cy="371.5" rx="28" ry="17" transform="rotate(-45 189 371.5)" stroke="#1565c0" opacity="0.85"/>
                        <ellipse cx="189" cy="371.5" rx="56" ry="34" transform="rotate(-45 189 371.5)" stroke="#1976d2" opacity="0.70"/>
                        <ellipse cx="189" cy="371.5" rx="88" ry="53" transform="rotate(-45 189 371.5)" stroke="#1e88e5" opacity="0.58"/>
                        <ellipse cx="189" cy="371.5" rx="126" ry="76" transform="rotate(-45 189 371.5)" stroke="#42a5f5" opacity="0.45"/>
                    </g>

                    <!-- Restri√ß√£o atual -->
                    <line id="constraint5" x1="65" y1="140" x2="520" y2="560" stroke="#ef5350" stroke-width="3"/>

                    <!-- Ponto √≥timo na restri√ß√£o e ponto atual -->
                    <circle id="optPoint5" cx="250" cy="300" r="8" fill="#64b5f6" stroke="#fff" stroke-width="1.6"/>
                    <text x="214" y="330" font-family="JetBrains Mono" font-size="12" fill="#64b5f6">Œª*(c)</text>
                    <circle id="curPoint5" cx="280" cy="330" r="11" fill="#ff5722" stroke="#fff" stroke-width="2"/>
                    <line id="optToCur5" x1="250" y1="300" x2="280" y2="330" stroke="#ffab91" stroke-width="1.8" stroke-dasharray="5,4"/>

                    <!-- Vetores -->
                    <line id="gradF5" x1="280" y1="330" x2="340" y2="290" stroke="#ff9800" stroke-width="2.8" marker-end="url(#arrowOrange5)"/>
                    <text id="labelF5" x="345" y="286" font-family="Crimson Pro" font-size="20" fill="#ffb74d" font-weight="600">‚àáf</text>

                    <line id="gradG5" x1="280" y1="330" x2="318" y2="292" stroke="#ab47bc" stroke-width="2.3" stroke-dasharray="5,3" marker-end="url(#arrowPurple5)"/>
                    <text id="labelG5" x="322" y="289" font-family="Crimson Pro" font-size="20" fill="#ce93d8" font-weight="600">‚àág</text>

                    <line id="tangComp5" x1="280" y1="330" x2="320" y2="365" stroke="#66bb6a" stroke-width="2.4" marker-end="url(#arrowGreen5)"/>
                    <text id="labelTang5" x="326" y="371" font-family="JetBrains Mono" font-size="12" fill="#a5d6a7">comp. tangencial</text>

                    <!-- Caixa de estado do painel esquerdo -->
                    <rect x="420" y="95" width="175" height="105" rx="6" fill="rgba(0,0,0,0.55)" stroke="rgba(255,255,255,0.20)"/>
                    <text id="leftInfoA5" x="432" y="122" font-family="JetBrains Mono" font-size="12" fill="#81d4fa">Œª*(c)=...</text>
                    <text id="leftInfoB5" x="432" y="144" font-family="JetBrains Mono" font-size="12" fill="#ffcc80">Œª atual=...</text>
                    <text id="leftInfoC5" x="432" y="166" font-family="JetBrains Mono" font-size="12" fill="#a5d6a7">comp.tang=...</text>
                    <text id="leftInfoD5" x="432" y="188" font-family="JetBrains Mono" font-size="12" fill="#e0e0e0">status: ...</text>

                    <!-- Ponte entre pain√©is -->
                    <line x1="615" y1="300" x2="642" y2="300" stroke="#ffd54f" stroke-width="3"/>
                    <polygon points="648,300 636,293 636,307" fill="#ffd54f"/>
                    <text x="607" y="274" font-family="Crimson Pro" font-size="18" fill="#ffd54f">projetar</text>
                    <text x="609" y="332" font-family="Crimson Pro" font-size="18" fill="#ffd54f">em c</text>

                    <!-- Painel direito -->
                    <rect x="650" y="40" width="610" height="540" rx="8" fill="#070b1d" stroke="rgba(255,255,255,0.14)"/>
                    <text x="810" y="74" font-family="Crimson Pro" font-size="28" fill="#81d4fa" font-weight="600">Vista em corte: œÉ¬≤*(c)</text>

                    <line x1="730" y1="520" x2="1230" y2="520" stroke="#a0a0a0" stroke-width="1.6" marker-end="url(#arrowAxis5)"/>
                    <line x1="730" y1="532" x2="730" y2="90" stroke="#a0a0a0" stroke-width="1.6" marker-end="url(#arrowAxis5)"/>
                    <text x="1205" y="552" font-family="Crimson Pro" font-size="24" fill="#a0a0a0">c</text>
                    <text x="690" y="102" font-family="Crimson Pro" font-size="23" fill="#a0a0a0" font-style="italic">œÉ¬≤*</text>

                    <!-- Grades verticais de refer√™ncia -->
                    <line x1="758" y1="520" x2="758" y2="110" stroke="rgba(239,83,80,0.2)" stroke-width="1.1" stroke-dasharray="4,5"/>
                    <line x1="897" y1="520" x2="897" y2="110" stroke="rgba(239,83,80,0.2)" stroke-width="1.1" stroke-dasharray="4,5"/>
                    <line x1="1036" y1="520" x2="1036" y2="110" stroke="rgba(239,83,80,0.2)" stroke-width="1.1" stroke-dasharray="4,5"/>
                    <line x1="1175" y1="520" x2="1175" y2="110" stroke="rgba(239,83,80,0.2)" stroke-width="1.1" stroke-dasharray="4,5"/>
                    <text x="746" y="545" font-family="JetBrains Mono" font-size="12" fill="#888">0.5</text>
                    <text x="885" y="545" font-family="JetBrains Mono" font-size="12" fill="#888">0.75</text>
                    <text x="1023" y="545" font-family="JetBrains Mono" font-size="12" fill="#888">1.0</text>
                    <text x="1163" y="545" font-family="JetBrains Mono" font-size="12" fill="#888">1.25</text>

                    <path id="curve5" fill="none" stroke="#6db1ff" stroke-width="4" stroke-linecap="round"/>

                    <line id="cLine5" x1="1036" y1="520" x2="1036" y2="110" stroke="#ff7043" stroke-width="1.8" stroke-dasharray="6,4"/>
                    <circle id="minPoint5" cx="1036" cy="300" r="8.5" fill="#64b5f6" stroke="#fff" stroke-width="1.7"/>
                    <circle id="currPoint5" cx="1036" cy="250" r="11" fill="#ff5722" stroke="#fff" stroke-width="2"/>

                    <line id="gap5" x1="1036" y1="300" x2="1036" y2="250" stroke="#ab47bc" stroke-width="2.4"/>
                    <text id="gapLabel5" x="1044" y="278" font-family="JetBrains Mono" font-size="12" fill="#ce93d8">gap</text>

                    <line id="tangent5" x1="950" y1="350" x2="1120" y2="250" stroke="rgba(102,187,106,0.6)" stroke-width="2" stroke-dasharray="6,5"/>

                    <line id="tanVec5" x1="1036" y1="300" x2="1080" y2="270" stroke="#66bb6a" stroke-width="3" marker-end="url(#arrowGreen5)"/>
                    <line id="compC5" x1="1036" y1="300" x2="1080" y2="300" stroke="#ff9800" stroke-width="2.3" marker-end="url(#arrowOrange5)"/>
                    <line id="compSig5" x1="1080" y1="300" x2="1080" y2="270" stroke="#ab47bc" stroke-width="2.3" marker-end="url(#arrowPurple5)"/>
                    <text id="compCLabel5" x="1047" y="320" font-family="JetBrains Mono" font-size="12" fill="#ffb74d">Œîc</text>
                    <text id="compSigLabel5" x="1087" y="286" font-family="JetBrains Mono" font-size="12" fill="#ce93d8">ŒîœÉ¬≤</text>
                    <text id="tanLabel5" x="1086" y="266" font-family="JetBrains Mono" font-size="12" fill="#a5d6a7">dire√ß√£o tangente</text>

                    <rect x="1090" y="112" width="160" height="128" rx="7" fill="rgba(0,0,0,0.58)" stroke="rgba(255,255,255,0.22)"/>
                    <text id="rightInfoA5" x="1100" y="138" font-family="JetBrains Mono" font-size="12" fill="#81d4fa">œÉ¬≤*(c)=...</text>
                    <text id="rightInfoB5" x="1100" y="160" font-family="JetBrains Mono" font-size="12" fill="#ffcc80">œÉ¬≤ atual=...</text>
                    <text id="rightInfoC5" x="1100" y="182" font-family="JetBrains Mono" font-size="12" fill="#ce93d8">gap=...</text>
                    <text id="rightInfoD5" x="1100" y="204" font-family="JetBrains Mono" font-size="12" fill="#a5d6a7">dœÉ¬≤*/dc=...</text>
                    <text id="rightInfoE5" x="1100" y="226" font-family="JetBrains Mono" font-size="12" fill="#fff59d">Œº=...</text>
                </svg>
            </div>

            <div class="key-insight" style="margin-top: 1rem;">
                <div class="key-insight-title">Como usar esta figura (did√°tica r√°pida)</div>
                <p>
                    Primeiro ajuste <strong>c</strong> para escolher qual restri√ß√£o est√° ativa. Depois mova
                    <strong>u</strong>: quando <strong>u = 0</strong>, o ponto laranja coincide com o m√≠nimo restrito
                    (comp. tangencial ~ 0). Para <strong>u ‚â† 0</strong>, a componente tangencial aparece e, no painel
                    direito, surge um <em>gap</em> entre o valor atual e a curva de m√≠nimos.
                </p>
            </div>
        </div>

        <!-- RESUMO FINAL -->
        <div class="section">
            <h2 class="section-title">Resumo: O Que Aprendemos</h2>
            
            <div class="math-box" style="font-size: 0.95rem;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <td style="padding: 0.6rem; color: #ffd54f; font-weight: 600;">Lagrangeano</td>
                        <td style="padding: 0.6rem;"><span class="math">L(Œª, Œº) = f(Œª) + Œº ¬∑ g(Œª)</span></td>
                        <td style="padding: 0.6rem; color: #888;">Combina objetivo e restri√ß√£o</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <td style="padding: 0.6rem; color: #ff9800; font-weight: 600;">Condi√ß√£o 1</td>
                        <td style="padding: 0.6rem;"><span class="math">‚àá<sub>Œª</sub>L = 0 ‚Üí ‚àáf = ‚àíŒº‚àág</span></td>
                        <td style="padding: 0.6rem; color: #888;">Gradientes paralelos</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <td style="padding: 0.6rem; color: #ef5350; font-weight: 600;">Condi√ß√£o 2</td>
                        <td style="padding: 0.6rem;"><span class="math">‚àÇL/‚àÇŒº = 0 ‚Üí g(Œª) = 0</span></td>
                        <td style="padding: 0.6rem; color: #888;">Sobre a restri√ß√£o</td>
                    </tr>
                    <tr>
                        <td style="padding: 0.6rem; color: #66bb6a; font-weight: 600;">Significado de Œº</td>
                        <td style="padding: 0.6rem;"><span class="math">Œº = -dœÉ¬≤*/dc</span></td>
                        <td style="padding: 0.6rem; color: #888;">Taxa de troca (sinal depende da conven√ß√£o)</td>
                    </tr>
                </table>
            </div>

            <div class="key-insight" style="margin-top: 1rem;">
                <div class="key-insight-title">üéØ Aplica√ß√£o na Krigagem</div>
                <p>Na Krigagem Ordin√°ria, resolvemos <span class="math">min œÉ¬≤(Œª)</span> sujeito a <span class="math">Œ£Œª·µ¢ = 1</span>. Em nota√ß√£o matricial: <span class="math">[C 1; 1·µÄ 0][Œª; Œº] = [c0; 1]</span>. O multiplicador Œº nasce exatamente desse problema de otimiza√ß√£o com restri√ß√£o.</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // PAR√ÇMETROS GLOBAIS
        // ============================================
        const skCenter = { lam1: 0.30, lam2: 0.45 };
        const scale = 140; // pixels por unidade de Œª

        function toSVG(lam1, lam2) {
            return {
                x: lam1 * scale,
                y: 280 - lam2 * scale
            };
        }

        function calcError(lam1, lam2) {
            const dx = lam1 - skCenter.lam1;
            const dy = lam2 - skCenter.lam2;
            return 2 * dx * dx + 2 * dy * dy + 1.2 * dx * dy;
        }

        function gradF(lam1, lam2) {
            const dx = lam1 - skCenter.lam1;
            const dy = lam2 - skCenter.lam2;
            return {
                x: 4 * dx + 1.2 * dy,
                y: 4 * dy + 1.2 * dx
            };
        }

        const cStar = skCenter.lam1 + skCenter.lam2;
        const kOptimal = 1.3; // Consistente com calcError no √≥timo restrito
        
        function optimalError(c) {
            return kOptimal * (c - cStar) * (c - cStar);
        }

        function dOptimalErrorDc(c) {
            return 2 * kOptimal * (c - cStar);
        }

        function muValue(c) {
            // Conven√ß√£o usada: L = f + Œº(Œª1 + Œª2 - c) => Œº = -dœÉ¬≤*/dc
            return -dOptimalErrorDc(c);
        }

        // ============================================
        // SE√á√ÉO 1
        // ============================================
        const slider1 = document.getElementById('slider1');
        const slider2 = document.getElementById('slider2');
        const val1 = document.getElementById('val1');
        const val2 = document.getElementById('val2');
        const status1 = document.getElementById('status1');
        const userPoint1 = document.getElementById('userPoint1');
        const distLine1 = document.getElementById('distLine1');
        const posInfo1 = document.getElementById('posInfo1');
        const errInfo1 = document.getElementById('errInfo1');

        function updateSection1() {
            const lam1 = slider1.value / 100;
            const lam2 = slider2.value / 100;
            
            val1.textContent = lam1.toFixed(2);
            val2.textContent = lam2.toFixed(2);

            const pos = toSVG(lam1, lam2);
            userPoint1.setAttribute('cx', pos.x);
            userPoint1.setAttribute('cy', pos.y);

            const centerSVG = toSVG(skCenter.lam1, skCenter.lam2);
            distLine1.setAttribute('x2', pos.x);
            distLine1.setAttribute('y2', pos.y);

            const err = calcError(lam1, lam2);
            
            posInfo1.textContent = `Œª = (${lam1.toFixed(2)}, ${lam2.toFixed(2)})`;
            errInfo1.textContent = err.toFixed(3);

            const g = lam1 + lam2 - 1;
            if (Math.abs(g) < 0.02) {
                status1.className = 'status-box status-optimal';
                status1.textContent = `g(Œª) = ${g.toFixed(2)} ‚úì Na restri√ß√£o!`;
            } else {
                status1.className = 'status-box status-suboptimal';
                status1.textContent = `g(Œª) = ${g.toFixed(2)} ‚úó Fora da restri√ß√£o`;
            }
        }

        slider1.addEventListener('input', updateSection1);
        slider2.addEventListener('input', updateSection1);
        updateSection1();

        // ============================================
        // SE√á√ÉO 2
        // ============================================
        const slider2a = document.getElementById('slider2a');
        const val2a = document.getElementById('val2a');
        const status2 = document.getElementById('status2');
        const point2 = document.getElementById('point2');
        const gradF2 = document.getElementById('gradF2');
        const gradG2 = document.getElementById('gradG2');
        const labelF2 = document.getElementById('labelF2');
        const labelG2 = document.getElementById('labelG2');
        const tangComp2 = document.getElementById('tangComp2');
        const tangLabel2 = document.getElementById('tangLabel2');
        const statusBox2 = document.getElementById('statusBox2');
        const statusText2a = document.getElementById('statusText2a');
        const statusText2b = document.getElementById('statusText2b');

        function updateSection2() {
            const t = slider2a.value / 100;
            const lam1 = 0.05 + t * 0.90;
            const lam2 = 1 - lam1;
            
            val2a.textContent = lam1.toFixed(2);

            const pos = toSVG(lam1, lam2);
            point2.setAttribute('cx', pos.x);
            point2.setAttribute('cy', pos.y);

            const gf = gradF(lam1, lam2);
            const gfMag = Math.sqrt(gf.x * gf.x + gf.y * gf.y);
            const gfScale = 55 / Math.max(gfMag, 0.1);
            
            const gfEnd = {
                x: pos.x + gf.x * gfScale,
                y: pos.y - gf.y * gfScale
            };
            gradF2.setAttribute('x1', pos.x);
            gradF2.setAttribute('y1', pos.y);
            gradF2.setAttribute('x2', gfEnd.x);
            gradF2.setAttribute('y2', gfEnd.y);
            labelF2.setAttribute('x', gfEnd.x + 5);
            labelF2.setAttribute('y', gfEnd.y - 5);

            const ggScale = 40;
            const ggDir = { x: 1/Math.sqrt(2), y: 1/Math.sqrt(2) };
            const ggEnd = {
                x: pos.x + ggDir.x * ggScale,
                y: pos.y - ggDir.y * ggScale
            };
            gradG2.setAttribute('x1', pos.x);
            gradG2.setAttribute('y1', pos.y);
            gradG2.setAttribute('x2', ggEnd.x);
            gradG2.setAttribute('y2', ggEnd.y);
            labelG2.setAttribute('x', ggEnd.x + 5);
            labelG2.setAttribute('y', ggEnd.y);

            const tangDir = { x: 1/Math.sqrt(2), y: -1/Math.sqrt(2) };
            const tangProj = gf.x * tangDir.x + gf.y * tangDir.y;
            
            const tcScale = 30;
            const tcEnd = {
                x: pos.x + tangDir.x * tangProj * tcScale,
                y: pos.y - tangDir.y * tangProj * tcScale
            };
            tangComp2.setAttribute('x1', pos.x);
            tangComp2.setAttribute('y1', pos.y);
            tangComp2.setAttribute('x2', tcEnd.x);
            tangComp2.setAttribute('y2', tcEnd.y);

            tangLabel2.setAttribute('x', tcEnd.x + 5);
            tangLabel2.setAttribute('y', tcEnd.y + 15);

            const err = calcError(lam1, lam2);
            status2.textContent = `œÉ¬≤ = ${err.toFixed(3)} | comp. tang = ${tangProj.toFixed(2)}`;

            if (Math.abs(tangProj) < 0.15) {
                statusBox2.setAttribute('fill', 'rgba(102,187,106,0.15)');
                statusBox2.setAttribute('stroke', '#66bb6a');
                statusText2a.textContent = '√ìTIMO!';
                statusText2a.setAttribute('fill', '#a5d6a7');
                statusText2b.textContent = '‚àáf ‚à• ‚àág';
                statusText2b.setAttribute('fill', '#a5d6a7');
                status2.className = 'status-box status-optimal';
            } else {
                statusBox2.setAttribute('fill', 'rgba(255,152,0,0.15)');
                statusBox2.setAttribute('stroke', '#ff9800');
                statusText2a.textContent = 'N√£o √© √≥timo';
                statusText2a.setAttribute('fill', '#ffcc80');
                statusText2b.textContent = `comp.tang = ${tangProj.toFixed(2)}`;
                statusText2b.setAttribute('fill', '#ffcc80');
                status2.className = 'status-box status-suboptimal';
            }
        }

        slider2a.addEventListener('input', updateSection2);
        updateSection2();

        // ============================================
        // SE√á√ÉO 3
        // ============================================
        const slider3 = document.getElementById('slider3');
        const val3 = document.getElementById('val3');
        const lagrangeFormula = document.getElementById('lagrangeFormula');
        const muExplain1 = document.getElementById('muExplain1');
        const muExplain2 = document.getElementById('muExplain2');
        const muExplain3 = document.getElementById('muExplain3');

        function updateSection3() {
            const mu = slider3.value / 50;
            val3.textContent = mu.toFixed(2);
            
            const muStr = mu >= 0 ? `+ ${Math.abs(mu).toFixed(1)}` : `‚àí ${Math.abs(mu).toFixed(1)}`;
            lagrangeFormula.textContent = `L = œÉ¬≤ ${muStr} ¬∑ g`;

            muExplain1.setAttribute('fill', Math.abs(mu) < 0.1 ? '#ffd54f' : '#888');
            muExplain2.setAttribute('fill', mu > 0.1 ? '#ffd54f' : '#888');
            muExplain3.setAttribute('fill', mu < -0.1 ? '#ffd54f' : '#888');
        }

        slider3.addEventListener('input', updateSection3);
        updateSection3();

        // ============================================
        // SE√á√ÉO 4 - FIGURA COMBINADA
        // ============================================
        // Escalas para o painel direito (curva œÉ¬≤*(c))
        // c de 0.4 a 1.4 ‚Üí x de 450 a 690 (240px para 1.0 de c)
        // œÉ¬≤ de 0 a 0.5 ‚Üí y de 280 a 80 (200px para 0.5 de œÉ¬≤)
        const cToXRight = (c) => 450 + (c - 0.4) * 240;
        const sigToYRight = (sig) => 280 - sig * 400;
        
        // Escalas para o painel esquerdo (espa√ßo Œª‚ÇÅ, Œª‚ÇÇ)
        // Œª de 0 a 1.4 ‚Üí 180px
        const lamToXLeft = (lam1) => 50 + lam1 * 180;
        const lamToYLeft = (lam2) => 290 - lam2 * 180;
        
        // Desenhar a curva œÉ¬≤*(c)
        function drawCurve4() {
            const curve4 = document.getElementById('curve4');
            const minSK4 = document.getElementById('minSK4');
            
            let pathD = '';
            for (let i = 0; i <= 50; i++) {
                const c = 0.4 + i * (1.4 - 0.4) / 50;
                const sig = optimalError(c);
                const x = cToXRight(c);
                const y = sigToYRight(sig);
                if (y > 50 && y < 290) {
                    if (pathD === '') {
                        pathD = `M ${x},${y}`;
                    } else {
                        pathD += ` L ${x},${y}`;
                    }
                }
            }
            curve4.setAttribute('d', pathD);
            
            // Posicionar o m√≠nimo SK
            const xMin = cToXRight(cStar);
            minSK4.setAttribute('cx', xMin);
            minSK4.setAttribute('cy', 280);
        }
        
        drawCurve4();

        const slider4 = document.getElementById('slider4');
        const val4 = document.getElementById('val4');
        const status4 = document.getElementById('status4');
        
        // Elementos do painel esquerdo
        const point4left = document.getElementById('point4left');
        const gradF4 = document.getElementById('gradF4');
        const gradG4 = document.getElementById('gradG4');
        const labelF4 = document.getElementById('labelF4');
        const labelG4 = document.getElementById('labelG4');
        const constraint100 = document.getElementById('constraint100');
        
        // Elementos do painel direito
        const point4right = document.getElementById('point4right');
        const vline4 = document.getElementById('vline4');
        const tangent4 = document.getElementById('tangent4');
        const muResult4 = document.getElementById('muResult4');
        const tanVec4 = document.getElementById('tanVec4');
        const compCVec4 = document.getElementById('compCVec4');
        const compSigVec4 = document.getElementById('compSigVec4');
        const normalVec4 = document.getElementById('normalVec4');
        const labelTanVec4 = document.getElementById('labelTanVec4');
        const labelCompCVec4 = document.getElementById('labelCompCVec4');
        const labelCompSigVec4 = document.getElementById('labelCompSigVec4');
        const labelNormalVec4 = document.getElementById('labelNormalVec4');

        function updateSection4() {
            const c = slider4.value / 100;
            val4.textContent = c.toFixed(2);

            const sig = optimalError(c);
            const dSigDc = dOptimalErrorDc(c);
            const mu = muValue(c);

            // ========== ATUALIZAR PAINEL ESQUERDO ==========
            // Solu√ß√£o anal√≠tica do m√≠nimo de f(Œª1, c-Œª1) sobre a linha Œª1 + Œª2 = c
            const lam1Opt = 0.5 * (c + skCenter.lam1 - skCenter.lam2);
            const lam2Opt = c - lam1Opt;
            
            const xLeft = lamToXLeft(lam1Opt);
            const yLeft = lamToYLeft(lam2Opt);
            
            point4left.setAttribute('cx', xLeft);
            point4left.setAttribute('cy', yLeft);
            
            // Atualizar a linha da restri√ß√£o atual
            // Œª‚ÇÅ + Œª‚ÇÇ = c ‚Üí passa por (0, c) e (c, 0)
            const x1Constraint = lamToXLeft(0);
            const y1Constraint = lamToYLeft(c);
            const x2Constraint = lamToXLeft(c);
            const y2Constraint = lamToYLeft(0);
            
            constraint100.setAttribute('x1', x1Constraint);
            constraint100.setAttribute('y1', Math.max(50, y1Constraint));
            constraint100.setAttribute('x2', Math.min(295, x2Constraint));
            constraint100.setAttribute('y2', Math.min(290, y2Constraint));
            
            // Gradiente ‚àáf no ponto √≥timo
            const gf = gradF(lam1Opt, lam2Opt);
            const gfMag = Math.sqrt(gf.x * gf.x + gf.y * gf.y);
            const gfScale = 45 / Math.max(gfMag, 0.1);
            
            const gfEndX = xLeft + gf.x * gfScale;
            const gfEndY = yLeft - gf.y * gfScale;
            
            gradF4.setAttribute('x1', xLeft);
            gradF4.setAttribute('y1', yLeft);
            gradF4.setAttribute('x2', gfEndX);
            gradF4.setAttribute('y2', gfEndY);
            labelF4.setAttribute('x', gfEndX + 5);
            labelF4.setAttribute('y', gfEndY - 3);
            
            // Gradiente ‚àág (sempre na dire√ß√£o (1,1) normalizada, perpendicular √† restri√ß√£o)
            const ggScale = 30;
            const ggDir = { x: 1/Math.sqrt(2), y: 1/Math.sqrt(2) };
            const ggEndX = xLeft + ggDir.x * ggScale;
            const ggEndY = yLeft - ggDir.y * ggScale;
            
            gradG4.setAttribute('x1', xLeft);
            gradG4.setAttribute('y1', yLeft);
            gradG4.setAttribute('x2', ggEndX);
            gradG4.setAttribute('y2', ggEndY);
            labelG4.setAttribute('x', ggEndX + 3);
            labelG4.setAttribute('y', ggEndY - 2);

            // ========== ATUALIZAR PAINEL DIREITO ==========
            const xRight = cToXRight(c);
            const yRight = sigToYRight(sig);

            point4right.setAttribute('cx', xRight);
            point4right.setAttribute('cy', yRight);

            vline4.setAttribute('x1', xRight);
            vline4.setAttribute('x2', xRight);
            vline4.setAttribute('y2', yRight);

            // Tangente no painel direito (curva de perfil sigma2*(c)):
            // y_screen = 280 - 400 * sigma2*(c), x_screen = 450 + 240 * c
            // => dy/dx (screen) = -(400/240) * d(sigma2*)/dc
            const slopeScreen = -(400 / 240) * dSigDc;
            const tangLen = 60;
            tangent4.setAttribute('x1', xRight - tangLen);
            tangent4.setAttribute('y1', yRight + slopeScreen * (-tangLen));
            tangent4.setAttribute('x2', xRight + tangLen);
            tangent4.setAttribute('y2', yRight + slopeScreen * tangLen);

            // Decomposi√ß√£o da dire√ß√£o tangente (verde = laranja + magenta)
            const compDx = 38;
            const compDy = slopeScreen * compDx;
            const compEndX = xRight + compDx;
            const compEndY = yRight + compDy;

            tanVec4.setAttribute('x1', xRight);
            tanVec4.setAttribute('y1', yRight);
            tanVec4.setAttribute('x2', compEndX);
            tanVec4.setAttribute('y2', compEndY);

            compCVec4.setAttribute('x1', xRight);
            compCVec4.setAttribute('y1', yRight);
            compCVec4.setAttribute('x2', compEndX);
            compCVec4.setAttribute('y2', yRight);

            compSigVec4.setAttribute('x1', compEndX);
            compSigVec4.setAttribute('y1', yRight);
            compSigVec4.setAttribute('x2', compEndX);
            compSigVec4.setAttribute('y2', compEndY);

            // Normal da curva no corte (2D), ortogonal √† tangente local.
            let nDx = -compDy;
            let nDy = compDx;
            const nNorm = Math.hypot(nDx, nDy) || 1;
            const nLen = 30;
            nDx = (nDx / nNorm) * nLen;
            nDy = (nDy / nNorm) * nLen;
            // Mantem a normal apontando para cima no painel, para leitura consistente.
            if (nDy > 0) {
                nDx = -nDx;
                nDy = -nDy;
            }
            const nEndX = xRight + nDx;
            const nEndY = yRight + nDy;
            normalVec4.setAttribute('x1', xRight);
            normalVec4.setAttribute('y1', yRight);
            normalVec4.setAttribute('x2', nEndX);
            normalVec4.setAttribute('y2', nEndY);

            labelTanVec4.setAttribute('x', compEndX > 676 ? compEndX - 80 : compEndX + 6);
            labelTanVec4.setAttribute('y', compEndY - 4);
            labelCompCVec4.setAttribute('x', xRight + 6);
            labelCompCVec4.setAttribute('y', yRight + 16);
            labelCompSigVec4.setAttribute('x', compEndX > 690 ? compEndX - 84 : compEndX + 4);
            labelCompSigVec4.setAttribute('y', yRight + compDy * 0.5 - 2);
            labelNormalVec4.setAttribute('x', nEndX < 520 ? nEndX + 4 : nEndX - 60);
            labelNormalVec4.setAttribute('y', nEndY - 4);

            muResult4.textContent = `${mu >= 0 ? '+' : ''}${mu.toFixed(2)}`;

            // Status
            if (Math.abs(c - 1.0) < 0.02) {
                status4.className = 'status-box status-optimal';
                status4.textContent = `c = 1.00 (OK) | œÉ¬≤* = ${sig.toFixed(3)} | dœÉ¬≤*/dc = ${dSigDc.toFixed(2)} | Œº = ${mu.toFixed(2)}`;
            } else if (Math.abs(c - cStar) < 0.03) {
                status4.className = 'status-box status-optimal';
                status4.textContent = `c = ${c.toFixed(2)} (SK) | œÉ¬≤* = ${sig.toFixed(3)} | dœÉ¬≤*/dc ‚âà 0 | Œº ‚âà 0`;
            } else {
                status4.className = 'status-box status-suboptimal';
                status4.textContent = `c = ${c.toFixed(2)} | œÉ¬≤* = ${sig.toFixed(3)} | dœÉ¬≤*/dc = ${dSigDc.toFixed(2)} | Œº = ${mu.toFixed(2)}`;
            }
        }

        slider4.addEventListener('input', updateSection4);
        updateSection4();

        // ============================================
        // SE√á√ÉO 5 - S√çNTESE (FIG. 2 + FIG. 4)
        // ============================================
        const slider5c = document.getElementById('slider5c');
        const slider5u = document.getElementById('slider5u');
        const val5c = document.getElementById('val5c');
        const val5u = document.getElementById('val5u');
        const status5 = document.getElementById('status5');

        if (slider5c && slider5u) {
            const constraint5 = document.getElementById('constraint5');
            const optPoint5 = document.getElementById('optPoint5');
            const curPoint5 = document.getElementById('curPoint5');
            const optToCur5 = document.getElementById('optToCur5');

            const gradF5 = document.getElementById('gradF5');
            const gradG5 = document.getElementById('gradG5');
            const tangComp5 = document.getElementById('tangComp5');
            const labelF5 = document.getElementById('labelF5');
            const labelG5 = document.getElementById('labelG5');
            const labelTang5 = document.getElementById('labelTang5');

            const leftInfoA5 = document.getElementById('leftInfoA5');
            const leftInfoB5 = document.getElementById('leftInfoB5');
            const leftInfoC5 = document.getElementById('leftInfoC5');
            const leftInfoD5 = document.getElementById('leftInfoD5');

            const curve5 = document.getElementById('curve5');
            const cLine5 = document.getElementById('cLine5');
            const minPoint5 = document.getElementById('minPoint5');
            const currPoint5 = document.getElementById('currPoint5');
            const gap5 = document.getElementById('gap5');
            const gapLabel5 = document.getElementById('gapLabel5');

            const tangent5 = document.getElementById('tangent5');
            const tanVec5 = document.getElementById('tanVec5');
            const compC5 = document.getElementById('compC5');
            const compSig5 = document.getElementById('compSig5');
            const compCLabel5 = document.getElementById('compCLabel5');
            const compSigLabel5 = document.getElementById('compSigLabel5');
            const tanLabel5 = document.getElementById('tanLabel5');

            const rightInfoA5 = document.getElementById('rightInfoA5');
            const rightInfoB5 = document.getElementById('rightInfoB5');
            const rightInfoC5 = document.getElementById('rightInfoC5');
            const rightInfoD5 = document.getElementById('rightInfoD5');
            const rightInfoE5 = document.getElementById('rightInfoE5');

            const left5 = { x0: 90, y0: 520, scale: 330 };
            const right5 = { cMin: 0.45, cMax: 1.35, x0: 730, xSpan: 500, sigMax: 0.9, y0: 520, ySpan: 420 };
            const rightSx = right5.xSpan / (right5.cMax - right5.cMin);
            const rightSy = right5.ySpan / right5.sigMax;
            const sqrt2 = Math.sqrt(2);

            function lamToLeft5(lam1, lam2) {
                return {
                    x: left5.x0 + lam1 * left5.scale,
                    y: left5.y0 - lam2 * left5.scale
                };
            }

            function cToRight5(c) {
                return right5.x0 + (c - right5.cMin) * rightSx;
            }

            function sigToRight5(sig) {
                const clamped = Math.max(0, Math.min(right5.sigMax, sig));
                return right5.y0 - clamped * rightSy;
            }

            function drawCurve5() {
                let d = "";
                const nSteps = 180;
                for (let i = 0; i <= nSteps; i += 1) {
                    const c = right5.cMin + (i / nSteps) * (right5.cMax - right5.cMin);
                    const sig = optimalError(c);
                    const x = cToRight5(c);
                    const y = sigToRight5(sig);
                    d += i === 0 ? `M ${x},${y}` : ` L ${x},${y}`;
                }
                curve5.setAttribute("d", d);
            }

            function updateSection5() {
                const c = Number(slider5c.value) / 100;
                const u = Number(slider5u.value) / 100;
                val5c.textContent = c.toFixed(2);
                val5u.textContent = u.toFixed(2);

                // √ìtimo restrito para c fixo e ponto atual deslocado ao longo da restri√ß√£o.
                const lam1Opt = 0.5 * (c + skCenter.lam1 - skCenter.lam2);
                const lam2Opt = c - lam1Opt;
                const lam1Cur = lam1Opt + u;
                const lam2Cur = lam2Opt - u;

                const pOpt = lamToLeft5(lam1Opt, lam2Opt);
                const pCur = lamToLeft5(lam1Cur, lam2Cur);

                // Restri√ß√£o ativa c = lambda1 + lambda2 (estendida para leitura visual).
                const pA = lamToLeft5(-0.15, c + 0.15);
                const pB = lamToLeft5(1.55, c - 1.55);
                constraint5.setAttribute("x1", pA.x);
                constraint5.setAttribute("y1", pA.y);
                constraint5.setAttribute("x2", pB.x);
                constraint5.setAttribute("y2", pB.y);

                optPoint5.setAttribute("cx", pOpt.x);
                optPoint5.setAttribute("cy", pOpt.y);
                curPoint5.setAttribute("cx", pCur.x);
                curPoint5.setAttribute("cy", pCur.y);
                optToCur5.setAttribute("x1", pOpt.x);
                optToCur5.setAttribute("y1", pOpt.y);
                optToCur5.setAttribute("x2", pCur.x);
                optToCur5.setAttribute("y2", pCur.y);

                const gf = gradF(lam1Cur, lam2Cur);
                const gfMag = Math.hypot(gf.x, gf.y);
                const gfStep = 0.16 / Math.max(gfMag, 1e-6);
                const pF = lamToLeft5(lam1Cur + gf.x * gfStep, lam2Cur + gf.y * gfStep);
                gradF5.setAttribute("x1", pCur.x);
                gradF5.setAttribute("y1", pCur.y);
                gradF5.setAttribute("x2", pF.x);
                gradF5.setAttribute("y2", pF.y);
                labelF5.setAttribute("x", pF.x + 6);
                labelF5.setAttribute("y", pF.y - 4);

                const nStep = 0.14;
                const pG = lamToLeft5(lam1Cur + nStep / sqrt2, lam2Cur + nStep / sqrt2);
                gradG5.setAttribute("x1", pCur.x);
                gradG5.setAttribute("y1", pCur.y);
                gradG5.setAttribute("x2", pG.x);
                gradG5.setAttribute("y2", pG.y);
                labelG5.setAttribute("x", pG.x + 4);
                labelG5.setAttribute("y", pG.y - 2);

                const tangProj = gf.x * (1 / sqrt2) + gf.y * (-1 / sqrt2);
                const tangStep = Math.max(-0.22, Math.min(0.22, tangProj * 0.22));
                const pT = lamToLeft5(lam1Cur + tangStep / sqrt2, lam2Cur - tangStep / sqrt2);
                tangComp5.setAttribute("x1", pCur.x);
                tangComp5.setAttribute("y1", pCur.y);
                tangComp5.setAttribute("x2", pT.x);
                tangComp5.setAttribute("y2", pT.y);
                labelTang5.setAttribute("x", pT.x + 5);
                labelTang5.setAttribute("y", pT.y + 16);

                const isOptimalOnConstraint = Math.abs(tangProj) < 0.03;
                const sigMin = optimalError(c);
                const sigCur = calcError(lam1Cur, lam2Cur);
                const gap = Math.max(0, sigCur - sigMin);

                leftInfoA5.textContent = `lambda*(c)=(${lam1Opt.toFixed(2)}, ${lam2Opt.toFixed(2)})`;
                leftInfoB5.textContent = `lambda atual=(${lam1Cur.toFixed(2)}, ${lam2Cur.toFixed(2)})`;
                leftInfoC5.textContent = `comp.tang=${tangProj.toFixed(3)}`;
                leftInfoD5.textContent = isOptimalOnConstraint ? "status: comp.tang ~ 0 (√≥timo local)" : "status: ainda h√° melhoria tangencial";

                // Painel direito: curva de m√≠nimos e ponto atual para o mesmo c.
                const xC = cToRight5(c);
                const yMin = sigToRight5(sigMin);
                const yCur = sigToRight5(sigCur);

                cLine5.setAttribute("x1", xC);
                cLine5.setAttribute("x2", xC);
                minPoint5.setAttribute("cx", xC);
                minPoint5.setAttribute("cy", yMin);
                currPoint5.setAttribute("cx", xC);
                currPoint5.setAttribute("cy", yCur);

                gap5.setAttribute("x1", xC);
                gap5.setAttribute("x2", xC);
                gap5.setAttribute("y1", yMin);
                gap5.setAttribute("y2", yCur);
                gapLabel5.setAttribute("x", xC + 8);
                gapLabel5.setAttribute("y", yMin + (yCur - yMin) * 0.5 + 4);
                gapLabel5.textContent = `gap=${gap.toFixed(3)}`;
                gapLabel5.setAttribute("opacity", gap < 0.002 ? "0" : "1");

                const dSigDc = dOptimalErrorDc(c);
                const mu = muValue(c);
                const slopeScreen = -(rightSy / rightSx) * dSigDc;
                const tangLen = 95;
                tangent5.setAttribute("x1", xC - tangLen);
                tangent5.setAttribute("y1", yMin + slopeScreen * (-tangLen));
                tangent5.setAttribute("x2", xC + tangLen);
                tangent5.setAttribute("y2", yMin + slopeScreen * tangLen);

                const vecDx = 46;
                const vecDy = slopeScreen * vecDx;
                const vx = xC + vecDx;
                const vy = yMin + vecDy;

                tanVec5.setAttribute("x1", xC);
                tanVec5.setAttribute("y1", yMin);
                tanVec5.setAttribute("x2", vx);
                tanVec5.setAttribute("y2", vy);

                compC5.setAttribute("x1", xC);
                compC5.setAttribute("y1", yMin);
                compC5.setAttribute("x2", vx);
                compC5.setAttribute("y2", yMin);

                compSig5.setAttribute("x1", vx);
                compSig5.setAttribute("y1", yMin);
                compSig5.setAttribute("x2", vx);
                compSig5.setAttribute("y2", vy);

                compCLabel5.setAttribute("x", xC + 8);
                compCLabel5.setAttribute("y", yMin + 20);
                compSigLabel5.setAttribute("x", vx + 6);
                compSigLabel5.setAttribute("y", yMin + vecDy * 0.5 + (vecDy < 0 ? -4 : 14));
                tanLabel5.setAttribute("x", vx > 1185 ? vx - 108 : vx + 6);
                tanLabel5.setAttribute("y", vy - 6);

                rightInfoA5.textContent = `sigma2*(c)=${sigMin.toFixed(3)}`;
                rightInfoB5.textContent = `sigma2 atual=${sigCur.toFixed(3)}`;
                rightInfoC5.textContent = `gap=${gap.toFixed(3)}`;
                rightInfoD5.textContent = `dsigma2*/dc=${dSigDc.toFixed(3)}`;
                rightInfoE5.textContent = `mu=${mu.toFixed(3)}`;

                if (Math.abs(u) < 1e-3) {
                    currPoint5.setAttribute("fill", "#42a5f5");
                    status5.className = "status-box status-optimal";
                    status5.textContent = `u = ${u.toFixed(2)} | ponto atual no m√≠nimo da restri√ß√£o (comp.tang ~ 0)`;
                } else {
                    currPoint5.setAttribute("fill", "#ff5722");
                    status5.className = "status-box status-suboptimal";
                    status5.textContent = `u = ${u.toFixed(2)} | fora do m√≠nimo restrito: comp.tang = ${tangProj.toFixed(3)}, gap = ${gap.toFixed(3)}`;
                }
            }

            drawCurve5();
            slider5c.addEventListener("input", updateSection5);
            slider5u.addEventListener("input", updateSection5);
            updateSection5();
        }
    </script>
</body>
</html>
